#!/bin/bash
RAM=${RAM:-2048}
CPU=${CPU:-2}
DISK_SIZE=${DISK_SIZE:-20G}

DISK_FILE="/vmdata/vm-disk.qcow2"
ISO_FILE="/vmdata/debian.iso"

if [ ! -f "$ISO_FILE" ]; then
    echo "Downloading Debian ISO..."
    wget -O $ISO_FILE https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.5.0-amd64-netinst.iso
fi

if [ ! -f "$DISK_FILE" ]; then
    echo "Creating disk of size $DISK_SIZE..."
    qemu-img create -f qcow2 $DISK_FILE $DISK_SIZE
fi

exec qemu-system-x86_64 \
    -enable-kvm \
    -m $RAM \
    -cpu host \
    -smp $CPU \
    -drive file=$DISK_FILE,format=qcow2 \
    -cdrom $ISO_FILE \
    -boot d \
    -nographic
